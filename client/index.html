<canvas id="myCanvas" width="1200" height="675" style="border:1px solid #000000"></canvas>


<script src="https://cdn.socket.io/socket.io-1.4.5.js">
</script>
<script>
	var socket = io(); //Connect to server
	var c = document.getElementById("myCanvas"); //Creates canvas
	var ctx = c.getContext("2d");

	socket.on('newPositions',function(data, clientId){ //listens for newPositions
        ctx.clearRect(0,0,1200,675);

        for(var i = 0; i < data.player.length; i++){ 
            var player = data.player[i];
            //console.log(player.number, clientId);
            if (player.pId == clientId){
                var client = data.player[i];
            } //find clientNo
        }

		for(var i = 0; i < data.player.length; i++){ //player draw loop
            var player = data.player[i];
            if (player.pId == clientId){
                ctx.fillText(player.number,1200/2,675/2);
                ctx.beginPath();
                ctx.arc(1200/2,675/2,10, 0, Math.PI*2);
                ctx.stroke();
                ctx.strokeStyle = "#55CCFF";
                ctx.beginPath();
                ctx.moveTo(1200/2,675/2);
                ctx.lineTo(1200/2 + player.spdX, 675/2 + player.spdY);
                ctx.stroke();
                ctx.strokeStyle = "#000000"
            } //if player is the client, draw them in the center
            else {
                //console.log(player.number,player.x,player.y);
                ctx.fillText(
                    player.number,
                    player.x - client.x + 1200/2,
                    //draw everyone else based on the client's pos
                    player.y - client.y + 675/2
                    );
                ctx.beginPath();
                ctx.arc(player.x - client.x + 1200/2,
                    player.y - client.y + 675/2,
                    10, 0, Math.PI*2);
                ctx.stroke();
            }
        };

        for(var i = 0; i < data.block.length; i++){ //block draw loop
            var block = data.block[i];
            ctx.fillRect(
                block.x1 - client.x + 1200/2, 
                //moves all blocks according to client's pos
                block.y1 - client.y + 675/2,
                block.x2,
                block.y2
                );
            };

        for(var i = 0; i < data.wall.length; i++){ //wall draw loop
            var wall = data.wall[i];
            ctx.beginPath();
            ctx.moveTo(
                wall.x1 - client.x + 1200/2,
                wall.y1 - client.y + 675/2);
                //console.log(wall.x1, wall.y1);
                ctx.lineTo(
                    wall.x2 - client.x + 1200/2,
                    wall.y2 - client.y + 675/2);
                //console.log(wall.x2, wall.x2);
                ctx.stroke();
            }

            for(var i = 0; i < data.hook.length; i++){ //wall hook loop
                var hook = data.hook[i];
                ctx.beginPath();
                ctx.moveTo(
                    hook.x1 - client.x + 1200/2,
                    hook.y1 - client.y + 675/2);
                    //console.log(wall.x1, wall.y1);
                ctx.lineTo(
                    hook.x2 - client.x + 1200/2,
                    hook.y2 - client.y + 675/2);
                    //console.log(wall.x2, wall.x2);
                ctx.stroke();
            }
        });

    //socket.emit('happy',{reason:'its my birthday'}); //Sends message happy with data its my birthday

	document.onkeydown = function(event){ //Key Down Detector
        if(event.keyCode === 68)      //d
            socket.emit('keyPress',{inputId:'right',state:true});
        else if(event.keyCode === 83) //s
            socket.emit('keyPress',{inputId:'down',state:true});
        else if(event.keyCode === 65) //a
            socket.emit('keyPress',{inputId:'left',state:true});
        else if(event.keyCode === 87) //w
            socket.emit('keyPress',{inputId:'up',state:true});
        else if(event.keyCode === 32) //space
            socket.emit('keyPress',{inputId:'space',state:true});
        else if(event.keyCode === 69) //e
            socket.emit('keyPress',{inputId:'grapple',state:true});

    }

    document.onkeyup = function(event){ // Key Up Detector
        if(event.keyCode === 68)      //d
            socket.emit('keyPress',{inputId:'right',state:false});
        else if(event.keyCode === 83) //s
            socket.emit('keyPress',{inputId:'down',state:false});
        else if(event.keyCode === 65) //a
            socket.emit('keyPress',{inputId:'left',state:false});
        else if(event.keyCode === 87) //w
            socket.emit('keyPress',{inputId:'up',state:false});
        else if(event.keyCode === 32) //space
            socket.emit('keyPress',{inputId:'space',state:false});
        else if(event.keyCode === 69) //e
            socket.emit('keyPress',{inputId:'grapple',state:false});
    }

    document.onmousedown = function(event){ //Mouse Down Detector
    	socket.emit('keyPress',{inputId:'lClick',state:true});
    }

    document.onmouseup = function(event){ //Mouse Down Detector
    	socket.emit('keyPress',{inputId:'lClick',state:false});
    }

    document.onmousemove = function(event){ //Mouse Move Detector
        var x = event.clientX - 1200/2;
        var y = event.clientY - 625/2;
    	var angle = Math.atan2(y,x);
    	socket.emit('keyPress',{inputId:'mouseAngle',state:angle});
    }
</script>